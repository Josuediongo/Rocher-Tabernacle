<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Administraction</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/images/logo3.jpg" type="image/jpg">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <style>
    body {
      padding-top: 70px;
      background-color: #f8f9fa;
      
    }
    .welcome-container {
      overflow: hidden;
      white-space: nowrap;
      box-sizing: border-box;
      border-bottom: 2px solid #0d6efd;
      padding: 0.5rem 0;
      margin-bottom: 1rem;
      font-weight: 700;
      font-size: 1.8rem;
      color: #0d6efd;
      position: relative;
      height: 3.2rem; /* hauteur pour √©viter saut */
    }

    .welcome-text {
      display: inline-block;
      padding-left: 100%; /* d√©part hors √©cran √† gauche */
      animation: slide-left-to-right 8s linear infinite;
      will-change: transform;
    }

    @keyframes slide-left-to-right {
      0% {
      transform: translateX(0);
    }
    100% {
      transform: translateX(-100%);
    }
  }

    .logo {
      font-weight: 700;
      font-size: 1.5rem;
      color: #0d6efd;
    }
    .scroll-text {
      font-size: 1.5rem;
      font-weight: bold;
      animation: scroll-color 5s infinite linear;
      white-space: nowrap;
      overflow: hidden;
    }
    @keyframes scroll-color {
      0% { color: #0d6efd; }
      25% { color: #198754; }
      50% { color: #dc3545; }
      75% { color: #fd7e14; }
      100% { color: #0d6efd; }
    }
    .inline-form { display: inline-block; margin-left: 5px; }
    .table-img { max-width: 60px; max-height: 40px; object-fit: cover; border-radius: 4px; }
    #parolesModal .modal-body,
    #categorieModal .modal-body {
      white-space: pre-wrap;
      max-height: 60vh;
      overflow-y: auto;
    }
    .toggle-form { display: none; margin-top: 1rem; }

     /* Am√©lioration: Ajout du curseur pointer sur boutons interactifs */
    button.btn {
      cursor: pointer;
    }

     /* Am√©lioration: Responsive tables avec overflow auto */
    table {
      width: 100%;
      table-layout: auto;
      word-wrap: break-word;
      background-color: white;
      border-radius: 6px;
      overflow: hidden;
    }

     /* Titres du tableau */
    thead th {
      background-color: #e3f2fd;
      color: #0d6efd;
      font-weight: bold;
      text-align: center;
    }

     /* Centrage et padding des cellules */
    td, th {
      text-align: center;
      padding: 10px;
      vertical-align: middle;
    }

      /* Boutons */
    .btn {
      border-radius: 20px;
      padding: 5px 10px;
      font-size: 0.9rem;
    }

    /* Boutons d‚Äôaction */
    .btn-danger {
      background-color: #dc3545;
      border: none;
    }

    .btn-primary {
      background-color: #0d6efd;
      border: none;
    }

    .btn-info {
      background-color: #17a2b8;
      border: none;
   }

    /* Bouton "Ajouter un Chant" */
    #addChantBtn {
      margin-top: 20px;
      border-radius: 20px;
      font-weight: bold;
    }

      /* Miniature image dans tableau */
    .table-img {
      max-width: 50px;
      max-height: 50px;
      object-fit: cover;
      border-radius: 4px;
    }

    /* Responsive */
    @media (max-width: 768px) {
    table {
      display: block;
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg fixed-top navbar-light bg-white shadow-sm">
  <div class="container">
     <img src="/images/logo3.jpg" width="30px" alt="Logo √âglise">
    <a class="navbar-brand logo" href="#">TABERNACLE DU ROCHER üéµ</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="#accueil">Accueil</a></li>
        <li class="nav-item"><a class="nav-link" href="#categorie">Cat√©gories</a></li>
        <li class="nav-item"><a class="nav-link" href="#chants">Chants</a></li>
        <li class="nav-item"><a class="nav-link" href="#favoris">Favoris</a></li>
      </ul>
    </div>
  </div>
</nav>

<main class="container mb-5">

  <!-- Accueil -->
<section id="accueil" class="mb-5">
  <div class="card shadow-lg border-0 p-4 bg-gradient bg-light-subtle">
    <div class="row align-items-center">
      <div class="col-md-2 text-center">
        <img src="/images/logo3.jpg" alt="Logo √âglise" class="img-fluid rounded-circle shadow-sm" style="max-width: 100px;" />
      </div>
      <div class="col-md-10">
        <div class="welcome-container" aria-label="Bienvenue">
          <span class="welcome-text">BIENVENUE, <%= utilisateur.nom %> !</span>
        </div>

        <p class="lead">üé∂üéºüé§üé∏üéπ Bienvenue Vous √™tes connect√© en tant qu‚Äôadministrateur <strong>Depuis cet espace s√©curis√©, </strong>.</p>
        <p class="text-muted">vous avez un contr√¥le complet sur les chant, les cat√©gories et les favoris : vous pouvez ajouter, modifier ou supprimer les contenus pour organiser efficacement le recueil de l‚Äô√©glise et le personnaliser selon les besoins des fid√®les.</p>
        <div class="mt-3">
          <a href="#categorie" class="btn btn-outline-primary me-2">üìÅ G√©rer les Cat√©gories</a>
          <a href="#chants" class="btn btn-outline-success">üéµ G√©rer les Chants</a>
        </div>
      </div>
    </div>
  </div>
</section>
<div class="row mt-4 text-center">
  <div class="col-md-4">
    <div class="card border-0 shadow-sm p-3">
      <h4 class="text-primary">üìÅ <%= categories.length %> Cat√©gories</h4>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card border-0 shadow-sm p-3">
      <h4 class="text-success">üéµ <%= chants.length %> Chants</h4>
    </div>
  </div>
  <div class="col-md-4">
    <div class="card border-0 shadow-sm p-3">
      <h4 class="text-danger">‚ù§Ô∏è <%= favoris.length %> Favoris</h4>
    </div>
  </div>
</div>



  <!-- Cat√©gories -->
  <section id="categorie" class="mb-5">
    <div class="card p-4 shadow-sm">
      <h2>Cat√©gories</h2>

      <input type="text" class="form-control mb-3" placeholder="Rechercher une cat√©gorie..." id="searchCategorie" aria-label="Rechercher une cat√©gorie" />

      <table class="table table-striped table-hover" aria-describedby="categorieTableDesc">
        <caption id="categorieTableDesc" class="visually-hidden">Liste des cat√©gories</caption>
        <thead>
          <tr>
            <th scope="col">Nom</th>
            <th scope="col">Description</th>
            <th scope="col">Actions</th>
          </tr>
        </thead>
        <tbody id="categorieTableBody">
          <% categories.forEach(cat => { %>
            <tr>
              <td><%= cat.nom %></td>
              <td><%= cat.description %></td>
              <td>
                <form action="/categories/<%= cat.id %>/delete" method="POST" class="inline-form" onsubmit="return confirm('Supprimer cette cat√©gorie ?');" aria-label="Supprimer cat√©gorie <%= cat.nom %>">
                  <button type="submit" class="btn btn-sm btn-danger" title="Supprimer">üóë</button>
                </form>
                <form action="/categories/<%= cat.id %>/edit" method="GET" class="inline-form" aria-label="√âditer cat√©gorie <%= cat.nom %>">
                  <button type="submit" class="btn btn-sm btn-primary" title="√âditer">‚úè</button>
                </form>
                <button class="btn btn-sm btn-info" title="Voir d√©tails cat√©gorie"
                  onclick="voirCategorie(
                    '<%= cat.nom.replace(/'/g, "\\'") %>',
                    '<%= cat.description.replace(/'/g, "\\'").replace(/\\n/g, '<br>') %>',
                    '<%= cat.photo %>'
                  )">üëÅ Voir</button>
              </td>
            </tr>
          <% }) %>
        </tbody>
      </table>

      <ul id="paginationCategorie" class="pagination"></ul>

      <button class="btn btn-success mt-3" onclick="toggleForm('formCategorie')" aria-expanded="false" aria-controls="formCategorie">‚ûï Ajouter un categorie</button>
      <form id="formCategorie" class="toggle-form" action="/categories" method="POST" enctype="multipart/form-data" aria-hidden="true">
        <input type="text" name="nom" class="form-control my-2" placeholder="Nom" required aria-label="Nom de la cat√©gorie" />
        <textarea name="description" class="form-control my-2" placeholder="Description" aria-label="Description de la cat√©gorie"></textarea>
        <input type="file" name="photo" class="form-control my-2" accept="image/*" aria-label="Photo de la cat√©gorie" />
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">‚úÖ Enregistrer</button>
          <button type="button" class="btn btn-secondary" onclick="toggleForm('formCategorie')">‚ùå Annuler</button>
        </div>
      </form>
    </div>
  </section>

  <!-- Modale Cat√©gorie -->
  <div class="modal fade" id="categorieModal" tabindex="-1" aria-labelledby="categorieModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="categorieModalLabel">D√©tails de la Cat√©gorie</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>
        <div class="modal-body" id="categorieContent"></div>
      </div>
    </div>
  </div>

  <!-- Chants -->
<section id="chants" class="mb-5">
  <div class="card p-4 shadow-sm">
    <h2>Chants</h2>

    <input type="text" class="form-control mb-3" placeholder="Rechercher un chant..." id="searchChants" />

    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Titre</th>
          <th>Langue</th>
          <th>Compositeur</th>
          <th>Numero_page</th>
          <th>cat√©gorie</th>
          <th>Image</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="chantsTableBody">
        <% chants.forEach(chant => { %>
        <tr>
          <td><%= chant.titre %></td>
          <td><%= chant.langue %></td>
          <td><%= chant.compositeur %></td>
          <td><%= chant.numero_page !== null && chant.numero_page !== undefined ? chant.numero_page : '-' %></td>
          <td><%= chant.categorie_nom || 'N/A' %></td>

          <td>
            <% if (chant.image) { %>
              <img src="<%= chant.image %>" alt="image" class="table-img">
            <% } else { %>-<% } %>
          </td>
          <td><form action="/chants/<%= chant.id %>/delete" method="POST" class="inline-form" onsubmit="return confirm('Supprimer ce chant ?');">
              <button type="submit" class="btn btn-sm btn-danger">üóë</button>
            </form>
            <form action="/admin/chants/<%= chant.id %>/edit" method="GET" class="inline-form">
              <button type="submit" class="btn btn-sm btn-primary">‚úè</button>
            </form>
            <button class="btn btn-sm btn-info" onclick="voirChant('<%= chant.titre %>', '<%= chant.compositeur %>', '<%= chant.paroles.replace(/\r?\n/g, '\\n').replace(/'/g, '\\\'') %>', '<%= chant.image %>', <%= chant.numero_page %>)">üëÅ Voir</button>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>

    <div class="text-center mt-3">
      <a href="/admin/chants/new" class="btn btn-success mt-3">‚ûï Ajouter un Chant</a>
    </div>
    <ul class="pagination justify-content-center mt-3" id="paginationChant"></ul>
  </div>
</section>

      <ul id="paginationChant" class="pagination"></ul>
      <form id="formChant" class="toggle-form" action="/chants" method="POST" enctype="multipart/form-data" aria-hidden="true">
        <input type="text" name="titre" class="form-control my-2" placeholder="Titre du chant" required aria-label="Titre du chant" />
        <textarea name="paroles" class="form-control my-2" placeholder="Paroles du chant" required aria-label="Paroles du chant"></textarea>
        <input type="text" name="compositeur" class="form-control my-2" placeholder="Compositeur" aria-label="Compositeur" />
        <input type="text" name="langue" class="form-control my-2" placeholder="Langue" aria-label="Langue" />
        <input type="number" name="numero_page" class="form-control my-2" placeholder="Num√©ro de page" min="1" aria-label="Num√©ro de page" />
        <select name="categorie_id" required>
  <option value="">-- S√©lectionner une cat√©gorie --</option>
  <% categories.forEach(cat¬†=>¬†{¬†%><option value="<%= cat.id %>"><%= cat.nom %></option>
  <% }) %>
</select>
        <input type="file" name="image" class="form-control my-2" accept="image/*" aria-label="Image du chant" />
        <div class="d-flex gap-2">
          <button type="submit" class="btn btn-primary">‚úÖ Enregistrer</button>
          <button type="button" class="btn btn-secondary" onclick="toggleForm('formChant')">‚ùå Annuler</button>
        </div>
      </form>
    </div>
  </section>

  <!-- Modale Chant -->
  <div class="modal fade" id="parolesModal" tabindex="-1" aria-labelledby="parolesModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="parolesModalLabel">Paroles du chant</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
        </div>
        <div class="modal-body" id="parolesContent"></div>
      </div>
    </div>
  </div>

  <!-- Favoris -->
  <section id="favoris">
    <div class="card p-4 shadow-sm">
      <h2>Favoris</h2>
      <table class="table table-striped table-hover" aria-describedby="favorisTableDesc">
        <caption id="favorisTableDesc" class="visually-hidden">Liste des favoris</caption>
        <thead>
          <tr>
            <th scope="col">Utilisateur</th>
            <th scope="col">Chant</th>
            <th scope="col">Date</th>
          </tr>
        </thead>
        <tbody>
          <% favoris.forEach(fav => { %>
            <tr>
              <td><%= fav.utilisateur_id %></td>
              <td><%= fav.chant_id %></td>
              <td><%= fav.date_ajout.toLocaleString() %></td>
            </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
  </section>
</main>

<footer class="text-center py-3 text-muted bg-light">
  &copy; <%= new Date().getFullYear() %> Recueil de chants | josue Diongo
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function toggleForm(id) {
    const form = document.getElementById(id);
    const isHidden = form.style.display === "none" || form.style.display === "";
    form.style.display = isHidden ? "block" : "none";

    // Am√©lioration: Mise √† jour de aria-expanded pour accessibilit√©
    const btn = document.querySelector(`[aria-controls="${id}"]`);
    if (btn) btn.setAttribute('aria-expanded', isHidden);
    form.setAttribute('aria-hidden', !isHidden);
  }

  function voirCategorie(nom, description, photo) {
    const content = document.getElementById('categorieContent');
    content.innerHTML = `
      <h4 style="color: blue;">${nom}</h4>
      <p>${description}</p>
      ${photo ? `<img src="/uploads/${photo}" alt="Photo cat√©gorie" class="img-fluid mt-3" style="max-height: 200px;">` : ''}
    `;
    new bootstrap.Modal(document.getElementById('categorieModal')).show();
  }

  function voirChant(titre, compositeur, paroles, image, page) {
    const content = document.getElementById('parolesContent');
    const formattedParoles = paroles.replace(/\\n/g, "<br>");
    content.innerHTML = `
      <h4 style="color: blue;">${titre}</h4>
      <h5 style="color: blue;">${compositeur}</h5>
      <div class="mt-2">${formattedParoles}</div>
      ${page ? `<p class="mt-3"><strong>Page :</strong> ${page}</p>` : ''}
      ${image ? `<img src="/uploads/${image}" alt="Image chant" class="img-fluid mt-3" style="max-height: 300px;">` : ''}
    `;
    new bootstrap.Modal(document.getElementById('parolesModal')).show();
  }

  function setupSearchAndPagination(tableBodyId, searchInputId, paginationId, rowsPerPage = 10) {
    const tableBody = document.getElementById(tableBodyId);
    const searchInput = document.getElementById(searchInputId);
    const pagination = document.getElementById(paginationId);
    const rows = Array.from(tableBody.querySelectorAll('tr'));
    let filteredRows = [...rows];
    let currentPage = 1;

    function renderPage(page) {
      currentPage = page;
      const start = (page - 1) * rowsPerPage;
      const end = start + rowsPerPage;
      rows.forEach((row, i) => {
        row.style.display = (filteredRows.indexOf(row) >= start && filteredRows.indexOf(row) < end) ? '' : 'none';
      });
      renderPagination();
    }

    function renderPagination() {
      pagination.innerHTML = '';
      const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
      if (totalPages <= 1) return;

      for (let i = 1; i <= totalPages; i++) {
        const li = document.createElement('li');
        li.classList.add('page-item');
        if (i === currentPage) li.classList.add('active');
        const a = document.createElement('a');
        a.classList.add('page-link');
        a.href = "#";
        a.textContent = i;
        a.addEventListener('click', e => {
          e.preventDefault();
          renderPage(i);
        });
        li.appendChild(a);
        pagination.appendChild(li);
      }
    }

    searchInput.addEventListener('input', () => {
      const query = searchInput.value.toLowerCase();
      filteredRows = rows.filter(row =>
        row.textContent.toLowerCase().includes(query)
      );
      renderPage(1);
    });

    renderPage(1);
  }

  document.addEventListener('DOMContentLoaded', () => {
    setupSearchAndPagination('categorieTableBody', 'searchCategorie', 'paginationCategorie', 5);
    setupSearchAndPagination('chantsTableBody', 'searchChants', 'paginationChant', 5);
  });
  const searchInput = document.getElementById('searchChants');
  const tableBody = document.getElementById('chantsTableBody');

  searchInput.addEventListener('input', () => {
    const query = searchInput.value.toLowerCase();
    const rows = tableBody.querySelectorAll('tr');

    rows.forEach(row => {
      const text = row.innerText.toLowerCase();
      row.style.display = text.includes(query) ? '' : 'none';
    });
  });
  // Gestion de l'affichage des sections via la navbar
document.addEventListener('DOMContentLoaded', () => {
  const sections = ['accueil', 'categorie', 'chants', 'favoris'];

  // Masquer toutes les sections sauf accueil
  sections.forEach(id => {
    const section = document.getElementById(id);
    if (id !== 'accueil') section.style.display = 'none';
  });

  // Ajouter les √©v√©nements aux liens du menu
  document.querySelectorAll('.navbar-nav .nav-link').forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const targetId = link.getAttribute('href').substring(1);

      // Masquer toutes les sections
      sections.forEach(id => {
        const section = document.getElementById(id);
        if (section) section.style.display = 'none';
      });

      // Afficher la section cibl√©e
      const targetSection = document.getElementById(targetId);
      if (targetSection) targetSection.style.display = 'block';
    });
  });
});



</script>
</body>
</html> 